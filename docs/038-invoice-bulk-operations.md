# チケット038: 請求書一括操作機能

## 概要
複数の請求書を選択して一括で操作する機能を実装。一括削除、一括PDF出力、一括エクスポートなどの効率的な管理機能を提供。

## 要件

### 一括選択機能
1. **選択UI**
   - チェックボックス（各行）
   - 全選択/全解除チェックボックス
   - 選択数の表示
   - 選択中アイテムのハイライト

2. **選択管理**
   - ページをまたいだ選択の保持
   - 最大選択数の制限（100件）
   - 選択状態のクリア

### 一括操作機能
1. **一括削除**
   - 確認ダイアログ
   - 削除件数の表示
   - プログレス表示
   - エラーハンドリング

2. **一括PDF出力**
   - 個別PDF生成
   - ZIPファイルでダウンロード
   - ファイル名規則
   - 最大10件制限

3. **一括エクスポート**
   - CSV形式
   - Excel形式（オプション）
   - カスタムフィールド選択
   - 文字コード選択（UTF-8/Shift-JIS）

4. **一括ステータス変更**（将来拡張）
   - 下書き→発行済み
   - 発行済み→支払済み

### UI/UX
1. **操作バー**
   - 選択時に表示
   - 実行可能な操作ボタン
   - 選択解除ボタン
   - スティッキーヘッダー

2. **フィードバック**
   - 処理中のプログレスバー
   - 成功/失敗の通知
   - エラー詳細の表示
   - 処理結果のサマリー

### API設計
```typescript
POST /api/invoices/bulk/delete
Body: {
  invoice_ids: string[]
}

POST /api/invoices/bulk/export
Body: {
  invoice_ids: string[],
  format: 'csv' | 'excel',
  fields: string[],
  encoding: 'utf-8' | 'shift-jis'
}

POST /api/invoices/bulk/pdf
Body: {
  invoice_ids: string[]
}
```

## タスク

### バックエンド実装
- [x] 一括削除API
- [x] 一括エクスポートAPI
- [x] 一括PDF生成API
- [x] バッチ処理の実装
- [x] トランザクション管理

### フロントエンド実装
- [x] チェックボックスコンポーネント
- [x] 一括操作バー
- [x] プログレス表示
- [ ] エクスポート設定モーダル

### 状態管理
- [x] 選択状態の管理
- [ ] 操作履歴
- [x] エラー状態

### パフォーマンス最適化
- [x] 非同期処理
- [x] チャンク処理
- [x] メモリ管理
- [ ] キャンセル機能

### テスト
- [x] 大量選択時の動作
- [x] 一括削除の確認
- [x] エクスポート形式
- [x] エラーケース

## 成功基準
- [x] 複数選択が正常に動作する
- [x] 一括削除が確認付きで実行される
- [x] CSVエクスポートが正常に動作する
- [x] 処理中のフィードバックが表示される
- [x] エラー時に適切な対処ができる

## 注意事項
- 大量データ処理時のタイムアウト対策
- メモリ使用量の監視
- 同時実行の制御
- ロールバック処理

## 依存関係
- ファイル圧縮ライブラリ（JSZip）
- CSVライブラリ（papaparse）
- 請求書一覧画面
- PDF生成機能（036で実装）