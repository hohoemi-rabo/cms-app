# チケット035: 請求書バリデーション・UX改善

## 概要
請求書機能全体のバリデーション強化とユーザビリティ改善を実施。エラーハンドリング、入力補助、確認画面などを追加。

## 要件

### バリデーション強化
1. **フロントエンドバリデーション**
   - リアルタイムエラー表示
   - 必須項目チェック
   - 数値範囲チェック
   - 文字数制限チェック
   - 日付妥当性チェック

2. **バックエンドバリデーション**
   - 必須項目の再チェック
   - データ型の検証
   - ビジネスロジック検証
   - SQLインジェクション対策
   - XSS対策

3. **エラーメッセージ**
   - 日本語での分かりやすいメッセージ
   - フィールド単位のエラー表示
   - 全体エラーのサマリー表示

### UX改善
1. **入力補助機能**
   - オートコンプリート
   - 入力履歴の活用
   - ショートカットキー
   - Tabキーでのフォーカス移動
   - Enterキーでの次フィールド移動

2. **確認機能**
   - 保存前のプレビュー
   - 変更確認ダイアログ
   - 未保存警告
   - 削除確認（実装済み）

3. **フィードバック**
   - 保存成功通知
   - エラー通知
   - ローディング表示
   - プログレス表示（明細追加時）

4. **ナビゲーション改善**
   - パンくずリスト
   - 戻るボタンの挙動改善
   - キーボードナビゲーション

### アクセシビリティ
1. **ARIA属性**
   - 適切なaria-label
   - エラー時のaria-invalid
   - aria-describedby

2. **キーボード操作**
   - すべての機能をキーボードで操作可能
   - フォーカス管理
   - Escキーでモーダル閉じる

## タスク

### バリデーション実装
- [x] フロントエンドバリデーションライブラリ導入（zod）
- [x] バリデーションスキーマ定義
- [x] エラーメッセージの日本語化
- [x] カスタムバリデーションルール

### UI/UX実装
- [ ] プレビューコンポーネント（Phase 3で実装予定）
- [x] 確認ダイアログコンポーネント
- [x] トースト通知の改善
- [x] ローディングスピナーの統一

### 入力補助実装
- [x] オートコンプリート機能（商品検索で実装済み）
- [x] キーボードショートカット（Enterキーナビゲーション）
- [x] フォーカス管理
- [ ] 入力履歴管理（Phase 3で実装予定）

### アクセシビリティ対応
- [x] ARIA属性の追加
- [x] キーボードナビゲーション
- [x] スクリーンリーダー対応
- [ ] カラーコントラスト確認（デザインシステムで対応済み）

### テスト
- [x] バリデーションテスト（zod統合テスト）
- [x] エラーメッセージ表示テスト
- [x] キーボード操作テスト
- [ ] アクセシビリティテスト（手動確認完了）

## 成功基準
- [x] すべての入力項目でバリデーションが機能する
- [x] エラーメッセージが日本語で表示される
- [x] キーボードのみで全操作が可能
- [x] 未保存データの警告が表示される
- [ ] プレビュー機能が正常に動作する（Phase 3で実装予定）

## 注意事項
- パフォーマンスを考慮（リアルタイムバリデーションの頻度）
- モバイル環境でのUX確認
- ブラウザ互換性の確認

## 依存関係
- zodライブラリ（バリデーション）
- react-hook-form（フォーム管理）
- 既存の請求書機能全般