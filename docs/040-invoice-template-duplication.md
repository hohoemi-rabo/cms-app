# チケット040: 請求書テンプレート・複製機能

## 概要
よく使う請求書パターンをテンプレート化し、既存請求書の複製機能を実装。定期的な請求書作成を効率化する。

## 要件

### テンプレート機能
1. **テンプレート作成**
   - 既存請求書からテンプレート化
   - テンプレート名の設定
   - カテゴリ分類
   - 説明文の追加

2. **テンプレート管理**
   - テンプレート一覧
   - テンプレート編集
   - テンプレート削除
   - お気に入り機能

3. **テンプレート利用**
   - テンプレートから請求書作成
   - 項目の部分的な利用
   - デフォルト値の上書き

### 複製機能
1. **請求書複製**
   - ワンクリック複製
   - 複製時の自動調整：
     - 請求書番号（新規採番）
     - 発行日（当日）
     - その他はコピー

2. **部分複製**
   - 明細のみ複製
   - 顧客情報のみ複製
   - カスタム選択複製

3. **一括複製**
   - 複数請求書の同時複製
   - 日付の一括変更
   - 顧客の一括変更

### 定期請求書機能（将来拡張）
1. **スケジュール設定**
   - 毎月/毎週/毎年
   - 特定日付指定
   - 営業日考慮

2. **自動生成**
   - スケジュールに基づく自動作成
   - 下書き状態で保存
   - 通知機能

### データ構造
```sql
invoice_templates
- id (UUID, PK)
- name (String, NOT NULL)
- category (String, Nullable)
- description (Text, Nullable)
- template_data (JSONB, NOT NULL)
- is_favorite (Boolean, DEFAULT false)
- usage_count (Integer, DEFAULT 0)
- created_at (Timestamp)
- updated_at (Timestamp)
- deleted_at (Timestamp, Nullable)

invoice_schedules (将来)
- id (UUID, PK)
- template_id (UUID, FK)
- schedule_type (String)
- schedule_config (JSONB)
- next_run_date (Date)
- is_active (Boolean)
```

## タスク

### データベース設定
- [ ] invoice_templatesテーブル作成
- [ ] インデックス設定
- [ ] マイグレーション

### バックエンド実装
- [ ] テンプレートCRUD API
- [ ] 複製処理API
- [ ] テンプレート利用API
- [ ] 使用回数カウント

### フロントエンド実装
- [ ] テンプレート管理画面
- [ ] テンプレート選択モーダル
- [ ] 複製ボタン・機能
- [ ] テンプレート作成フロー

### UI/UX改善
- [ ] テンプレートプレビュー
- [ ] ドラッグ&ドロップ並び替え
- [ ] クイックアクション
- [ ] ショートカットキー

### テスト
- [ ] テンプレート作成・利用
- [ ] 複製機能
- [ ] データ整合性
- [ ] パフォーマンス

## 成功基準
- [ ] テンプレートから請求書が作成できる
- [ ] 既存請求書の複製が正常に動作する
- [ ] テンプレートの管理機能が使いやすい
- [ ] 複製時に請求書番号が正しく採番される
- [ ] よく使うテンプレートが簡単に選べる

## 注意事項
- テンプレートデータの肥大化対策
- バージョン管理の考慮
- 共有機能の将来対応
- セキュリティ（テンプレートの権限管理）

## 依存関係
- 請求書作成機能
- 請求書一覧画面
- JSONBデータ型のサポート

## 将来の拡張
- チーム間でのテンプレート共有
- テンプレートマーケットプレイス
- AIによるテンプレート提案
- 定期請求書の自動生成