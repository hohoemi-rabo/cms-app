# チケット037: 請求書検索・フィルター機能

## 概要
請求書一覧画面に高度な検索・フィルター機能を実装。期間、顧客、金額範囲などの条件で請求書を絞り込み可能にする。

## 要件

### 検索機能
1. **テキスト検索**
   - 請求書番号
   - 請求先名
   - 備考
   - あいまい検索対応

2. **期間検索**
   - 発行日の範囲指定
   - 当月/前月/今年などのクイック選択
   - カレンダーUI

3. **金額検索**
   - 金額範囲指定（最小〜最大）
   - 以上/以下の条件

4. **顧客検索**
   - 顧客選択ドロップダウン
   - 複数選択可能
   - 直接入力分も検索対象

### フィルター機能
1. **ステータスフィルター**（将来拡張用）
   - すべて
   - 下書き
   - 発行済み
   - 支払済み

2. **並び替え**
   - 発行日（新しい順/古い順）
   - 請求書番号
   - 金額（高い順/低い順）
   - 請求先名（五十音順）

3. **表示件数**
   - 20件/50件/100件
   - ページネーション

### UI/UX
1. **検索UI**
   - 検索バー（メイン）
   - 詳細検索パネル（展開式）
   - 検索条件のクリアボタン
   - 検索条件の保存（ローカルストレージ）

2. **検索結果表示**
   - ヒット件数表示
   - 検索条件のタグ表示
   - 「該当なし」メッセージ
   - 検索中のローディング表示

### API設計
```typescript
GET /api/invoices/search
Query Parameters:
- q: string (テキスト検索)
- date_from: string (開始日)
- date_to: string (終了日)
- amount_min: number (最小金額)
- amount_max: number (最大金額)
- customer_ids: string[] (顧客ID)
- sort_by: string (並び順)
- sort_order: 'asc' | 'desc'
- page: number
- limit: number
```

## タスク

### バックエンド実装
- [ ] 検索APIエンドポイント
- [ ] SQLクエリ最適化
- [ ] インデックス追加
- [ ] ページネーション処理

### フロントエンド実装
- [ ] 検索バーコンポーネント
- [ ] 詳細検索パネル
- [ ] フィルターコンポーネント
- [ ] 検索結果表示
- [ ] ページネーション

### 状態管理
- [ ] 検索条件の状態管理
- [ ] URLクエリパラメータ同期
- [ ] ローカルストレージ保存

### UI改善
- [ ] デバウンス処理
- [ ] オートコンプリート
- [ ] 検索履歴
- [ ] キーボードショートカット

### テスト
- [ ] 各検索条件のテスト
- [ ] 複合条件検索
- [ ] パフォーマンステスト
- [ ] エッジケース

## 成功基準
- [ ] 各検索条件で正しく絞り込みができる
- [ ] 複数条件の組み合わせが可能
- [ ] 検索が1秒以内に完了する
- [ ] 検索条件がURLに反映される
- [ ] モバイルでも使いやすい

## 注意事項
- SQLインジェクション対策
- 大量データでのパフォーマンス
- 検索インデックスの設計
- キャッシュ戦略

## 依存関係
- Supabaseの全文検索機能
- tanstack/react-query（キャッシュ管理）
- 請求書一覧画面