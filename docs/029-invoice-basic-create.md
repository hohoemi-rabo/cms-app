# 029 - 請求書作成機能（基本版）

## 概要

請求書の基本的な作成機能を実装。
**骨組み重視**: 最小限の項目での作成、顧客連携や商品マスタは後回し。

## 対象範囲

### 画面仕様
- URL: `/invoices/new`
- シンプルなフォーム形式
- 明細は最大3行から開始（後で10行に拡張）
- 自動計算機能

### 入力項目（最小構成）
**基本情報**
- 発行日（デフォルト：今日）
- 請求先名（テキスト入力のみ）

**明細情報**
- 品目名（テキスト入力）
- 数量（数値）
- 単価（数値）
- 金額（自動計算）

**合計金額**
- 合計金額（自動計算）

## Tasks

- [x] `/src/app/invoices/new/page.tsx` 作成
- [x] 請求書作成API作成 (`POST /api/invoices`)
- [x] フォームコンポーネント実装
- [x] 明細行の動的追加・削除機能
- [x] 金額自動計算機能実装
- [x] フォームバリデーション実装
- [x] 請求書番号自動採番機能実装
- [x] 作成成功時の詳細画面への遷移
- [x] エラーハンドリング実装

## UI設計方針

### レイアウト
```
┌─────────────────────────────────┐
│ [戻る] 請求書作成               │
├─────────────────────────────────┤
│ 発行日: [2024-12-09]            │
│ 請求先: [テキスト入力]           │
├─────────────────────────────────┤
│ 明細                           │
│ ┌─────┬─────┬─────┬─────────┐ │
│ │品目  │数量  │単価  │金額     │ │
│ │[入力]│[入力]│[入力]│[自動計算]│ │
│ │[入力]│[入力]│[入力]│[自動計算]│ │
│ └─────┴─────┴─────┴─────────┘ │
│ [+行追加] [行削除]              │
├─────────────────────────────────┤
│                    合計: [計算]円│
│ [キャンセル] [保存]             │
└─────────────────────────────────┘
```

### フォーム仕様
- shadcn/ui の Form, Input コンポーネント使用
- リアルタイム計算（数量×単価）
- 合計金額のリアルタイム更新

## 機能仕様

### 請求書番号生成
```typescript
// フォーマット: INV-YYYYMMDD-0001
// 例: INV-20241209-0001
const generateInvoiceNumber = () => {
  const today = new Date()
  const dateStr = format(today, 'yyyyMMdd')
  const sequence = getNextSequence() // 1から開始
  return `INV-${dateStr}-${sequence.toString().padStart(4, '0')}`
}
```

### バリデーション
- 請求先名: 必須、最大100文字
- 明細: 最低1行必須
- 品目名: 必須、最大50文字
- 数量: 0より大きい数値
- 単価: 0以上の数値

## 注意事項

1. **機能を絞る**:
   - 顧客選択機能は後で追加
   - 商品マスタ連携は後で追加
   - 税額計算は後で追加
   - 支払期限設定は後で追加

2. **エラーハンドリング**:
   - バリデーションエラーの適切な表示
   - API エラー時の処理
   - 重複送信防止

3. **UX考慮**:
   - 未保存時の離脱警告は後で追加
   - 自動保存機能は後で追加

## 成功基準

- [x] 基本情報が入力できる
- [x] 明細行の追加・削除ができる
- [x] 金額が自動計算される
- [x] バリデーションが正しく動作する
- [x] 請求書番号が自動生成される
- [x] 保存後に詳細画面に遷移する
- [x] エラー時に適切なメッセージが表示される