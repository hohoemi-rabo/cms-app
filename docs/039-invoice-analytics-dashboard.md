# チケット039: 請求書分析・ダッシュボード

## 概要
請求書データの分析機能とダッシュボードを実装。売上推移、顧客別集計、商品別集計などの可視化により、ビジネスインサイトを提供。

## 要件

### ダッシュボード画面
1. **サマリーカード**
   - 今月の請求額合計
   - 今月の請求書件数
   - 平均請求額
   - 前月比の増減率

2. **グラフ・チャート**
   - 月別売上推移（棒グラフ/線グラフ）
   - 顧客別売上（円グラフ）
   - 商品別売上（横棒グラフ）
   - 日別請求書発行数（カレンダーヒートマップ）

3. **期間選択**
   - 今月/前月/今四半期/今年
   - カスタム期間指定
   - 比較期間の選択

### 分析機能
1. **売上分析**
   - 期間別集計
   - 成長率計算
   - 移動平均
   - 前年同期比

2. **顧客分析**
   - 顧客別請求額ランキング
   - 新規/既存顧客の割合
   - 顧客単価の推移
   - ABC分析

3. **商品分析**
   - 商品別売上ランキング
   - 商品カテゴリ別集計
   - 単価×数量の分析
   - 人気商品の推移

4. **詳細レポート**
   - 期間指定レポート
   - CSVエクスポート
   - PDF レポート生成
   - 定期レポート設定（将来）

### UI/UX
1. **レスポンシブデザイン**
   - デスクトップ/タブレット/モバイル対応
   - グラフのインタラクティブ操作
   - ツールチップ表示
   - ドリルダウン機能

2. **パフォーマンス**
   - データのキャッシュ
   - 遅延ローディング
   - 仮想スクロール

### API設計
```typescript
GET /api/analytics/summary
Query: {
  period: 'month' | 'quarter' | 'year' | 'custom',
  date_from?: string,
  date_to?: string
}

GET /api/analytics/trends
Query: {
  metric: 'revenue' | 'count' | 'average',
  group_by: 'day' | 'week' | 'month',
  date_from: string,
  date_to: string
}

GET /api/analytics/breakdown
Query: {
  dimension: 'customer' | 'product' | 'category',
  metric: 'revenue' | 'count',
  limit: number
}
```

## タスク

### バックエンド実装
- [ ] 集計APIエンドポイント
- [ ] SQLクエリ最適化
- [ ] キャッシュ機構
- [ ] 集計バッチ処理

### フロントエンド実装
- [ ] ダッシュボードレイアウト
- [ ] グラフコンポーネント
- [ ] 期間選択コンポーネント
- [ ] データテーブル

### チャート実装
- [ ] Chart.jsまたはRechartsの導入
- [ ] グラフコンポーネント作成
- [ ] インタラクティブ機能
- [ ] レスポンシブ対応

### データ処理
- [ ] 集計ロジック
- [ ] データ変換処理
- [ ] エラーハンドリング
- [ ] ローディング状態

### テスト
- [ ] 集計精度の確認
- [ ] パフォーマンステスト
- [ ] 各種グラフの表示
- [ ] エクスポート機能

## 成功基準
- [ ] 各種集計値が正確に表示される
- [ ] グラフが適切に描画される
- [ ] 期間切り替えが正常に動作する
- [ ] 3秒以内にダッシュボードが表示される
- [ ] モバイルでも見やすく表示される

## 注意事項
- 大量データでのパフォーマンス
- グラフライブラリのバンドルサイズ
- リアルタイム更新の考慮
- タイムゾーンの扱い

## 依存関係
- チャートライブラリ（Chart.js or Recharts）
- 日付処理ライブラリ（date-fns）
- 請求書データ
- 集計用インデックス